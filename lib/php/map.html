<script src="https://maps.googleapis.com/maps/api/js"></script>
<script>
  var aggarray = [];
  function initialize() {
    $.get("/common/map/current.json", function(data){
      aggdatalist = data.features;
      aggdict = {};
      aggdatalist.forEach(function(aggregate){
        aggdict[aggregate.properties.am] = [aggregate.geometry.coordinates[1], aggregate.geometry.coordinates[0], aggregate.properties.am];
      });
      for (agg in aggdict) {
        aggarray.push(aggdict[agg]);
      }
    var mapCanvas = document.getElementById('map1');
    var mapOptions = {
      center: new google.maps.LatLng(42,-72),
      zoom: 3,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    }
    var map = new google.maps.Map(mapCanvas, mapOptions);
    var infowindow = new google.maps.InfoWindow(); 

    for (i in aggarray){
      var myLatlng = new google.maps.LatLng(aggarray[i][0], aggarray[i][1]);
      var marker = new google.maps.Marker({
        position: myLatlng,
        map: map,
        title: aggarray[i][2]
      });

      google.maps.event.addListener(marker, 'click', function() {
        infowindow.setContent("<span style='color:black;'>" + this.title + "</span>");
        infowindow.open(map, this);
      });
    }
    });
  }
  google.maps.event.addDomListener(window, 'load', initialize);
</script>
<div id="map1"></div>
